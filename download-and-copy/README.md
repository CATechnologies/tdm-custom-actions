# TDM Action Service Example - Download & Copy
This action downloads a file generated by a generator and copies it to a target host (using `scp`).

Steps:
   * Download generated files (REST call, zip archive returned)
   * Unzip archive
   * Copy data to to a target host/folder
   
## SSH Configuration Files - MUST BE ADDED
SCP command is used to copy files to the remote host. You will need to add your own SSH configuration.

   1. You can build and start your container without SSH config
   1. Attach to the running container 
   ..* `docker exec -it download-action /bin/bash`
   1. Run `ssh-keygen` (confirm default, including empty passphrase)
   1. Copy generated files (`id_rsa`, `id_rsa.pub`) to `conf` folder
   1. Add content of your public key (`id_rsa.pub`) to the target host to `.ssh/authorized_keys` 
   (`cat id_rsa.pub >> ~/.ssh/authorized_keys`)
   1. Create `know_hosts` file `conf` folder and add public key of your target host (`id_rsa.pub`) to this file.
   1. *UNCOMMENT* SSH configuration commands in the `Dockerfile`

## TDM Variables
Pass following variables to the action:
   * `targetHost` - hostname of your target
   * `targetFolder` - data will be copied to this folder on the target host
   * `targetUser` - target host user whose identity will be used to connect to the target host

## Environment variables which configure the container
This image inherits from the base TDM image. `PUBLISH_ACTION` is set in the [Dockerfile](Dockerfile) to point to
`echo.sh` script.

When running the container, you have to define `ACTION_SECRET`.

`ACTION_SECRET` - choose a secret which you will enter when you create the Action in the UI.

## To build the image locally
Use script [Docker.build.sh](Docker.build.sh).

Optionally, you can change version of TDM base image in [tdm.version.sh](../tdm.version.sh).

## To run the image
Use script [Docker.run.sh](Docker.run.sh).
